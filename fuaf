--[[
    Custom UI Library for Executors
    Version 2.0
    Enhanced and optimized for modern Roblox script executors
]]

if getgenv().CustomUILib then
    getgenv().CustomUILib:Destroy()
end

local CustomUILib = {}
local LoadTime = tick()

-- Services
local Services = {
    Workspace = game:GetService("Workspace"),
    UserInputService = game:GetService("UserInputService"),
    Players = game:GetService("Players"),
    HttpService = game:GetService("HttpService"),
    RunService = game:GetService("RunService"),
    TweenService = game:GetService("TweenService"),
    CoreGui = (cloneref and cloneref(game:GetService("CoreGui"))) or game:GetService("CoreGui")
}

-- Get HUI function for better compatibility
gethui = gethui or function()
    return Services.CoreGui
end

-- Local references
local LocalPlayer = Services.Players.LocalPlayer
local Camera = Services.Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- Performance optimizations
local Color3 = {
    new = Color3.new,
    fromRGB = Color3.fromRGB,
    fromHSV = Color3.fromHSV,
    fromHex = Color3.fromHex
}

local UDim2new = UDim2.new
local Vector2new = Vector2.new
local Instancenew = Instance.new

-- Library configuration
CustomUILib.Config = {
    Theme = {
        Background = Color3.fromRGB(15, 15, 15),
        Border = Color3.fromRGB(40, 40, 40),
        Accent = Color3.fromRGB(100, 200, 255),
        Text = Color3.fromRGB(255, 255, 255),
        TextDark = Color3.fromRGB(180, 180, 180),
        Element = Color3.fromRGB(25, 25, 25),
        ElementHover = Color3.fromRGB(35, 35, 35),
        Success = Color3.fromRGB(100, 255, 100),
        Warning = Color3.fromRGB(255, 200, 100),
        Error = Color3.fromRGB(255, 100, 100)
    },
    Font = Font.fromEnum(Enum.Font.Gotham),
    ToggleKey = Enum.KeyCode.RightControl,
    TweenSpeed = 0.2,
    Flags = {},
    Connections = {},
    Windows = {}
}

-- Utility Functions
local Utils = {}

function Utils:Tween(object, properties, duration, style, direction)
    duration = duration or CustomUILib.Config.TweenSpeed
    style = style or Enum.EasingStyle.Quad
    direction = direction or Enum.EasingDirection.Out
    
    local tween = Services.TweenService:Create(
        object,
        TweenInfo.new(duration, style, direction),
        properties
    )
    tween:Play()
    return tween
end

function Utils:MakeDraggable(frame, dragArea)
    dragArea = dragArea or frame
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    dragArea.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)
    
    Services.UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            frame.Position = UDim2new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    Services.UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end

function Utils:CreateInstance(class, properties)
    local instance = Instancenew(class)
    for property, value in pairs(properties) do
        instance[property] = value
    end
    return instance
end

function Utils:AddCorner(instance, radius)
    local corner = Instancenew("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 4)
    corner.Parent = instance
    return corner
end

function Utils:AddStroke(instance, color, thickness)
    local stroke = Instancenew("UIStroke")
    stroke.Color = color or CustomUILib.Config.Theme.Border
    stroke.Thickness = thickness or 1
    stroke.Parent = instance
    return stroke
end

-- Create main ScreenGui
CustomUILib.ScreenGui = Utils:CreateInstance("ScreenGui", {
    Name = "CustomUILib_" .. Services.HttpService:GenerateGUID(false),
    Parent = gethui(),
    ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
    ResetOnSpawn = false
})

-- Window Creation
function CustomUILib:CreateWindow(options)
    options = options or {}
    local windowName = options.Name or "Custom UI"
    local windowSize = options.Size or UDim2new(0, 550, 0, 400)
    
    local Window = {
        Tabs = {},
        CurrentTab = nil,
        Visible = true
    }
    
    -- Main Frame
    local MainFrame = Utils:CreateInstance("Frame", {
        Name = "MainFrame",
        Parent = CustomUILib.ScreenGui,
        BackgroundColor3 = CustomUILib.Config.Theme.Background,
        Position = UDim2new(0.5, -windowSize.X.Offset/2, 0.5, -windowSize.Y.Offset/2),
        Size = windowSize,
        BorderSizePixel = 0
    })
    Utils:AddCorner(MainFrame, 6)
    Utils:AddStroke(MainFrame, CustomUILib.Config.Theme.Border, 1)
    
    -- Title Bar
    local TitleBar = Utils:CreateInstance("Frame", {
        Name = "TitleBar",
        Parent = MainFrame,
        BackgroundColor3 = CustomUILib.Config.Theme.Element,
        Size = UDim2new(1, 0, 0, 35),
        BorderSizePixel = 0
    })
    Utils:AddCorner(TitleBar, 6)
    
    local TitleLabel = Utils:CreateInstance("TextLabel", {
        Name = "Title",
        Parent = TitleBar,
        BackgroundTransparency = 1,
        Position = UDim2new(0, 10, 0, 0),
        Size = UDim2new(0.7, 0, 1, 0),
        Font = CustomUILib.Config.Font,
        Text = windowName,
        TextColor3 = CustomUILib.Config.Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Close Button
    local CloseButton = Utils:CreateInstance("TextButton", {
        Name = "CloseButton",
        Parent = TitleBar,
        BackgroundColor3 = CustomUILib.Config.Theme.Error,
        Position = UDim2new(1, -30, 0.5, -10),
        Size = UDim2new(0, 20, 0, 20),
        Font = CustomUILib.Config.Font,
        Text = "X",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 12,
        BorderSizePixel = 0
    })
    Utils:AddCorner(CloseButton, 3)
    
    CloseButton.MouseButton1Click:Connect(function()
        Window:Toggle()
    end)
    
    -- Tab Container
    local TabContainer = Utils:CreateInstance("Frame", {
        Name = "TabContainer",
        Parent = MainFrame,
        BackgroundColor3 = CustomUILib.Config.Theme.Element,
        Position = UDim2new(0, 0, 0, 40),
        Size = UDim2new(0, 120, 1, -40),
        BorderSizePixel = 0
    })
    
    local TabList = Utils:CreateInstance("UIListLayout", {
        Parent = TabContainer,
        Padding = UDim.new(0, 5),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    Utils:CreateInstance("UIPadding", {
        Parent = TabContainer,
        PaddingTop = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 5),
        PaddingRight = UDim.new(0, 5)
    })
    
    -- Content Container
    local ContentContainer = Utils:CreateInstance("Frame", {
        Name = "ContentContainer",
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2new(0, 125, 0, 40),
        Size = UDim2new(1, -130, 1, -45),
        BorderSizePixel = 0
    })
    
    -- Make draggable
    Utils:MakeDraggable(MainFrame, TitleBar)
    
    -- Toggle function
    function Window:Toggle()
        Window.Visible = not Window.Visible
        MainFrame.Visible = Window.Visible
    end
    
    -- Create Tab
    function Window:CreateTab(tabName)
        local Tab = {
            Name = tabName,
            Elements = {},
            Active = false
        }
        
        -- Tab Button
        local TabButton = Utils:CreateInstance("TextButton", {
            Name = tabName,
            Parent = TabContainer,
            BackgroundColor3 = CustomUILib.Config.Theme.Background,
            Size = UDim2new(1, 0, 0, 30),
            Font = CustomUILib.Config.Font,
            Text = tabName,
            TextColor3 = CustomUILib.Config.Theme.TextDark,
            TextSize = 11,
            BorderSizePixel = 0
        })
        Utils:AddCorner(TabButton, 4)
        
        -- Tab Content
        local TabContent = Utils:CreateInstance("ScrollingFrame", {
            Name = tabName .. "_Content",
            Parent = ContentContainer,
            BackgroundTransparency = 1,
            Size = UDim2new(1, 0, 1, 0),
            ScrollBarThickness = 4,
            BorderSizePixel = 0,
            Visible = false,
            CanvasSize = UDim2new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y
        })
        
        local ContentList = Utils:CreateInstance("UIListLayout", {
            Parent = TabContent,
            Padding = UDim.new(0, 8),
            SortOrder = Enum.SortOrder.LayoutOrder
        })
        
        Utils:CreateInstance("UIPadding", {
            Parent = TabContent,
            PaddingTop = UDim.new(0, 5),
            PaddingLeft = UDim.new(0, 5),
            PaddingRight = UDim.new(0, 10)
        })
        
        -- Tab activation
        function Tab:Activate()
            for _, otherTab in pairs(Window.Tabs) do
                otherTab.Active = false
                otherTab.Button.BackgroundColor3 = CustomUILib.Config.Theme.Background
                otherTab.Button.TextColor3 = CustomUILib.Config.Theme.TextDark
                otherTab.Content.Visible = false
            end
            
            Tab.Active = true
            TabButton.BackgroundColor3 = CustomUILib.Config.Theme.Accent
            TabButton.TextColor3 = CustomUILib.Config.Theme.Text
            TabContent.Visible = true
            Window.CurrentTab = Tab
        end
        
        TabButton.MouseButton1Click:Connect(function()
            Tab:Activate()
        end)
        
        -- Button hover effects
        TabButton.MouseEnter:Connect(function()
            if not Tab.Active then
                Utils:Tween(TabButton, {BackgroundColor3 = CustomUILib.Config.Theme.ElementHover}, 0.1)
            end
        end)
        
        TabButton.MouseLeave:Connect(function()
            if not Tab.Active then
                Utils:Tween(TabButton, {BackgroundColor3 = CustomUILib.Config.Theme.Background}, 0.1)
            end
        end)
        
        Tab.Button = TabButton
        Tab.Content = TabContent
        
        -- Add Button
        function Tab:AddButton(options)
            options = options or {}
            local buttonText = options.Text or "Button"
            local callback = options.Callback or function() end
            
            local Button = Utils:CreateInstance("TextButton", {
                Name = "Button",
                Parent = TabContent,
                BackgroundColor3 = CustomUILib.Config.Theme.Element,
                Size = UDim2new(1, 0, 0, 30),
                Font = CustomUILib.Config.Font,
                Text = buttonText,
                TextColor3 = CustomUILib.Config.Theme.Text,
                TextSize = 11,
                BorderSizePixel = 0
            })
            Utils:AddCorner(Button, 4)
            
            Button.MouseButton1Click:Connect(function()
                Utils:Tween(Button, {BackgroundColor3 = CustomUILib.Config.Theme.Accent}, 0.1)
                task.wait(0.1)
                Utils:Tween(Button, {BackgroundColor3 = CustomUILib.Config.Theme.Element}, 0.1)
                pcall(callback)
            end)
            
            Button.MouseEnter:Connect(function()
                Utils:Tween(Button, {BackgroundColor3 = CustomUILib.Config.Theme.ElementHover}, 0.1)
            end)
            
            Button.MouseLeave:Connect(function()
                Utils:Tween(Button, {BackgroundColor3 = CustomUILib.Config.Theme.Element}, 0.1)
            end)
            
            return Button
        end
        
        -- Add Toggle
        function Tab:AddToggle(options)
            options = options or {}
            local toggleText = options.Text or "Toggle"
            local default = options.Default or false
            local flag = options.Flag
            local callback = options.Callback or function() end
            
            local Toggle = {
                Value = default,
                Flag = flag
            }
            
            local ToggleFrame = Utils:CreateInstance("Frame", {
                Name = "Toggle",
                Parent = TabContent,
                BackgroundColor3 = CustomUILib.Config.Theme.Element,
                Size = UDim2new(1, 0, 0, 30),
                BorderSizePixel = 0
            })
            Utils:AddCorner(ToggleFrame, 4)
            
            local ToggleLabel = Utils:CreateInstance("TextLabel", {
                Name = "Label",
                Parent = ToggleFrame,
                BackgroundTransparency = 1,
                Position = UDim2new(0, 10, 0, 0),
                Size = UDim2new(0.7, 0, 1, 0),
                Font = CustomUILib.Config.Font,
                Text = toggleText,
                TextColor3 = CustomUILib.Config.Theme.Text,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local ToggleButton = Utils:CreateInstance("TextButton", {
                Name = "Button",
                Parent = ToggleFrame,
                BackgroundColor3 = CustomUILib.Config.Theme.Background,
                Position = UDim2new(1, -50, 0.5, -10),
                Size = UDim2new(0, 40, 0, 20),
                Text = "",
                BorderSizePixel = 0
            })
            Utils:AddCorner(ToggleButton, 10)
            
            local ToggleIndicator = Utils:CreateInstance("Frame", {
                Name = "Indicator",
                Parent = ToggleButton,
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                Position = UDim2new(0, 2, 0.5, -8),
                Size = UDim2new(0, 16, 0, 16),
                BorderSizePixel = 0
            })
            Utils:AddCorner(ToggleIndicator, 8)
            
            function Toggle:Set(value)
                Toggle.Value = value
                if flag then
                    CustomUILib.Config.Flags[flag] = value
                end
                
                if value then
                    Utils:Tween(ToggleButton, {BackgroundColor3 = CustomUILib.Config.Theme.Accent}, 0.15)
                    Utils:Tween(ToggleIndicator, {Position = UDim2new(1, -18, 0.5, -8)}, 0.15)
                else
                    Utils:Tween(ToggleButton, {BackgroundColor3 = CustomUILib.Config.Theme.Background}, 0.15)
                    Utils:Tween(ToggleIndicator, {Position = UDim2new(0, 2, 0.5, -8)}, 0.15)
                end
                
                pcall(callback, value)
            end
            
            ToggleButton.MouseButton1Click:Connect(function()
                Toggle:Set(not Toggle.Value)
            end)
            
            Toggle:Set(default)
            
            return Toggle
        end
        
        -- Add Slider
        function Tab:AddSlider(options)
            options = options or {}
            local sliderText = options.Text or "Slider"
            local min = options.Min or 0
            local max = options.Max or 100
            local default = options.Default or 50
            local increment = options.Increment or 1
            local flag = options.Flag
            local callback = options.Callback or function() end
            
            local Slider = {
                Value = default,
                Dragging = false,
                Flag = flag
            }
            
            local SliderFrame = Utils:CreateInstance("Frame", {
                Name = "Slider",
                Parent = TabContent,
                BackgroundColor3 = CustomUILib.Config.Theme.Element,
                Size = UDim2new(1, 0, 0, 45),
                BorderSizePixel = 0
            })
            Utils:AddCorner(SliderFrame, 4)
            
            local SliderLabel = Utils:CreateInstance("TextLabel", {
                Name = "Label",
                Parent = SliderFrame,
                BackgroundTransparency = 1,
                Position = UDim2new(0, 10, 0, 5),
                Size = UDim2new(0.7, 0, 0, 15),
                Font = CustomUILib.Config.Font,
                Text = sliderText,
                TextColor3 = CustomUILib.Config.Theme.Text,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local ValueLabel = Utils:CreateInstance("TextLabel", {
                Name = "Value",
                Parent = SliderFrame,
                BackgroundTransparency = 1,
                Position = UDim2new(1, -50, 0, 5),
                Size = UDim2new(0, 40, 0, 15),
                Font = CustomUILib.Config.Font,
                Text = tostring(default),
                TextColor3 = CustomUILib.Config.Theme.Accent,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Right
            })
            
            local SliderBar = Utils:CreateInstance("Frame", {
                Name = "Bar",
                Parent = SliderFrame,
                BackgroundColor3 = CustomUILib.Config.Theme.Background,
                Position = UDim2new(0, 10, 1, -15),
                Size = UDim2new(1, -20, 0, 6),
                BorderSizePixel = 0
            })
            Utils:AddCorner(SliderBar, 3)
            
            local SliderFill = Utils:CreateInstance("Frame", {
                Name = "Fill",
                Parent = SliderBar,
                BackgroundColor3 = CustomUILib.Config.Theme.Accent,
                Size = UDim2new(0.5, 0, 1, 0),
                BorderSizePixel = 0
            })
            Utils:AddCorner(SliderFill, 3)
            
            function Slider:Set(value)
                value = math.clamp(value, min, max)
                value = math.floor(value / increment + 0.5) * increment
                Slider.Value = value
                
                if flag then
                    CustomUILib.Config.Flags[flag] = value
                end
                
                local percent = (value - min) / (max - min)
                SliderFill:TweenSize(UDim2new(percent, 0, 1, 0), "Out", "Quad", 0.1, true)
                ValueLabel.Text = tostring(value)
                
                pcall(callback, value)
            end
            
            SliderBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Slider.Dragging = true
                    local percent = math.clamp((Mouse.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1)
                    local value = min + (max - min) * percent
                    Slider:Set(value)
                end
            end)
            
            Services.UserInputService.InputChanged:Connect(function(input)
                if Slider.Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local percent = math.clamp((Mouse.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1)
                    local value = min + (max - min) * percent
                    Slider:Set(value)
                end
            end)
            
            Services.UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Slider.Dragging = false
                end
            end)
            
            Slider:Set(default)
            
            return Slider
        end
        
        -- Add Dropdown
        function Tab:AddDropdown(options)
            options = options or {}
            local dropdownText = options.Text or "Dropdown"
            local items = options.Items or {}
            local default = options.Default
            local flag = options.Flag
            local callback = options.Callback or function() end
            
            local Dropdown = {
                Value = default,
                Items = items,
                Open = false,
                Flag = flag
            }
            
            local DropdownFrame = Utils:CreateInstance("Frame", {
                Name = "Dropdown",
                Parent = TabContent,
                BackgroundColor3 = CustomUILib.Config.Theme.Element,
                Size = UDim2new(1, 0, 0, 30),
                BorderSizePixel = 0,
                ClipsDescendants = false
            })
            Utils:AddCorner(DropdownFrame, 4)
            
            local DropdownButton = Utils:CreateInstance("TextButton", {
                Name = "Button",
                Parent = DropdownFrame,
                BackgroundTransparency = 1,
                Size = UDim2new(1, 0, 0, 30),
                Font = CustomUILib.Config.Font,
                Text = default or dropdownText,
                TextColor3 = CustomUILib.Config.Theme.Text,
                TextSize = 11,
                BorderSizePixel = 0
            })
            
            local ItemList = Utils:CreateInstance("Frame", {
                Name = "ItemList",
                Parent = DropdownFrame,
                BackgroundColor3 = CustomUILib.Config.Theme.Background,
                Position = UDim2new(0, 0, 1, 2),
                Size = UDim2new(1, 0, 0, 0),
                BorderSizePixel = 0,
                Visible = false,
                ClipsDescendants = true,
                ZIndex = 10
            })
            Utils:AddCorner(ItemList, 4)
            Utils:AddStroke(ItemList, CustomUILib.Config.Theme.Border, 1)
            
            local ItemListLayout = Utils:CreateInstance("UIListLayout", {
                Parent = ItemList,
                Padding = UDim.new(0, 2),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            Utils:CreateInstance("UIPadding", {
                Parent = ItemList,
                PaddingTop = UDim.new(0, 5),
                PaddingBottom = UDim.new(0, 5),
                PaddingLeft = UDim.new(0, 5),
                PaddingRight = UDim.new(0, 5)
            })
            
            function Dropdown:Set(value)
                Dropdown.Value = value
                if flag then
                    CustomUILib.Config.Flags[flag] = value
                end
                DropdownButton.Text = value
                pcall(callback, value)
            end
            
            function Dropdown:Toggle()
                Dropdown.Open = not Dropdown.Open
                ItemList.Visible = Dropdown.Open
                
                if Dropdown.Open then
                    local itemCount = #Dropdown.Items
                    local targetHeight = math.min(itemCount * 25 + 10, 150)
                    ItemList:TweenSize(UDim2new(1, 0, 0, targetHeight), "Out", "Quad", 0.2, true)
                else
                    ItemList:TweenSize(UDim2new(1, 0, 0, 0), "Out", "Quad", 0.2, true)
                end
            end
            
            function Dropdown:Refresh(newItems)
                for _, child in pairs(ItemList:GetChildren()) do
                    if child:IsA("TextButton") then
                        child:Destroy()
                    end
                end
                
                Dropdown.Items = newItems
                
                for _, item in pairs(newItems) do
                    local ItemButton = Utils:CreateInstance("TextButton", {
                        Name = item,
                        Parent = ItemList,
                        BackgroundColor3 = CustomUILib.Config.Theme.Element,
                        Size = UDim2new(1, 0, 0, 25),
                        Font = CustomUILib.Config.Font,
                        Text = item,
                        TextColor3 = CustomUILib.Config.Theme.Text,
                        TextSize = 10,
                        BorderSizePixel = 0,
                        ZIndex = 11
                    })
                    Utils:AddCorner(ItemButton, 3)
                    
                    ItemButton.MouseButton1Click:Connect(function()
                        Dropdown:Set(item)
                        Dropdown:Toggle()
                    end)
                    
                    ItemButton.MouseEnter:Connect(function()
                        Utils:Tween(ItemButton, {BackgroundColor3 = CustomUILib.Config.Theme.Accent}, 0.1)
                    end)
                    
                    ItemButton.MouseLeave:Connect(function()
                        Utils:Tween(ItemButton, {BackgroundColor3 = CustomUILib.Config.Theme.Element}, 0.1)
                    end)
                end
            end
            
            DropdownButton.MouseButton1Click:Connect(function()
                Dropdown:Toggle()
            end)
            
            Dropdown:Refresh(items)
            if default then
                Dropdown:Set(default)
            end
            
            return Dropdown
        end
        
        -- Add Label
        function Tab:AddLabel(text)
            local Label = Utils:CreateInstance("TextLabel", {
                Name = "Label",
                Parent = TabContent,
                BackgroundTransparency = 1,
                Size = UDim2new(1, 0, 0, 20),
                Font = CustomUILib.Config.Font,
                Text = text or "Label",
                TextColor3 = CustomUILib.Config.Theme.TextDark,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left,
                BorderSizePixel = 0
            })
            
            function Label:SetText(newText)
                Label.Text = newText
            end
            
            return Label
        end
        
        -- Add Textbox
        function Tab:AddTextbox(options)
            options = options or {}
            local textboxText = options.Text or "Textbox"
            local placeholder = options.Placeholder or "Enter text..."
            local default = options.Default or ""
            local flag = options.Flag
            local callback = options.Callback or function() end
            
            local Textbox = {
                Value = default,
                Flag = flag
            }
            
            local TextboxFrame = Utils:CreateInstance("Frame", {
                Name = "Textbox",
                Parent = TabContent,
                BackgroundColor3 = CustomUILib.Config.Theme.Element,
                Size = UDim2new(1, 0, 0, 55),
                BorderSizePixel = 0
            })
            Utils:AddCorner(TextboxFrame, 4)
            
            local TextboxLabel = Utils:CreateInstance("TextLabel", {
                Name = "Label",
                Parent = TextboxFrame,
                BackgroundTransparency = 1,
                Position = UDim2new(0, 10, 0, 5),
                Size = UDim2new(1, -20, 0, 15),
                Font = CustomUILib.Config.Font,
                Text = textboxText,
                TextColor3 = CustomUILib.Config.Theme.Text,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local TextboxInput = Utils:CreateInstance("TextBox", {
                Name = "Input",
                Parent = TextboxFrame,
                BackgroundColor3 = CustomUILib.Config.Theme.Background,
                Position = UDim2new(0, 10, 0, 25),
                Size = UDim2new(1, -20, 0, 25),
                Font = CustomUILib.Config.Font,
                PlaceholderText = placeholder,
                PlaceholderColor3 = CustomUILib.Config.Theme.TextDark,
                Text = default,
                TextColor3 = CustomUILib.Config.Theme.Text,
                TextSize = 10,
                BorderSizePixel = 0,
                ClearTextOnFocus = false
            })
            Utils:AddCorner(TextboxInput, 3)
            
            function Textbox:Set(value)
                Textbox.Value = value
                if flag then
                    CustomUILib.Config.Flags[flag] = value
                end
                TextboxInput.Text = value
                pcall(callback, value)
            end
            
            TextboxInput.FocusLost:Connect(function()
                Textbox:Set(TextboxInput.Text)
            end)
            
            return Textbox
        end
        
        table.insert(Window.Tabs, Tab)
        
        -- Auto-activate first tab
        if #Window.Tabs == 1 then
            Tab:Activate()
        end
        
        return Tab
    end
    
    -- Destroy function
    function Window:Destroy()
        MainFrame:Destroy()
        for i, win in pairs(CustomUILib.Config.Windows) do
            if win == Window then
                table.remove(CustomUILib.Config.Windows, i)
                break
            end
        end
    end
    
    table.insert(CustomUILib.Config.Windows, Window)
    
    return Window
end

-- Notification System
function CustomUILib:Notify(options)
    options = options or {}
    local title = options.Title or "Notification"
    local text = options.Text or "No message provided"
    local duration = options.Duration or 3
    local type = options.Type or "Info" -- Info, Success, Warning, Error
    
    local notifColor = CustomUILib.Config.Theme.Accent
    if type == "Success" then
        notifColor = CustomUILib.Config.Theme.Success
    elseif type == "Warning" then
        notifColor = CustomUILib.Config.Theme.Warning
    elseif type == "Error" then
        notifColor = CustomUILib.Config.Theme.Error
    end
    
    local NotifFrame = Utils:CreateInstance("Frame", {
        Name = "Notification",
        Parent = CustomUILib.ScreenGui,
        BackgroundColor3 = CustomUILib.Config.Theme.Background,
        Position = UDim2new(1, -320, 0, 20),
        Size = UDim2new(0, 300, 0, 70),
        BorderSizePixel = 0,
        ZIndex = 100
    })
    Utils:AddCorner(NotifFrame, 6)
    Utils:AddStroke(NotifFrame, notifColor, 2)
    
    local AccentBar = Utils:CreateInstance("Frame", {
        Name = "Accent",
        Parent = NotifFrame,
        BackgroundColor3 = notifColor,
        Size = UDim2new(0, 4, 1, 0),
        BorderSizePixel = 0
    })
    
    local TitleLabel = Utils:CreateInstance("TextLabel", {
        Name = "Title",
        Parent = NotifFrame,
        BackgroundTransparency = 1,
        Position = UDim2new(0, 15, 0, 8),
        Size = UDim2new(1, -25, 0, 18),
        Font = Font.fromEnum(Enum.Font.GothamBold),
        Text = title,
        TextColor3 = CustomUILib.Config.Theme.Text,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local TextLabel = Utils:CreateInstance("TextLabel", {
        Name = "Text",
        Parent = NotifFrame,
        BackgroundTransparency = 1,
        Position = UDim2new(0, 15, 0, 28),
        Size = UDim2new(1, -25, 1, -35),
        Font = CustomUILib.Config.Font,
        Text = text,
        TextColor3 = CustomUILib.Config.Theme.TextDark,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true
    })
    
    NotifFrame.Position = UDim2new(1, 0, 0, 20)
    Utils:Tween(NotifFrame, {Position = UDim2new(1, -320, 0, 20)}, 0.3, Enum.EasingStyle.Back)
    
    task.delay(duration, function()
        Utils:Tween(NotifFrame, {Position = UDim2new(1, 0, 0, 20)}, 0.3, Enum.EasingStyle.Back)
        task.wait(0.3)
        NotifFrame:Destroy()
    end)
end

-- Destroy function
function CustomUILib:Destroy()
    if CustomUILib.ScreenGui then
        CustomUILib.ScreenGui:Destroy()
    end
    
    for _, connection in pairs(CustomUILib.Config.Connections) do
        if connection and connection.Connected then
            connection:Disconnect()
        end
    end
    
    CustomUILib.Config.Connections = {}
    CustomUILib.Config.Windows = {}
    
    getgenv().CustomUILib = nil
end

-- Toggle UI with keybind
Services.UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == CustomUILib.Config.ToggleKey then
        for _, window in pairs(CustomUILib.Config.Windows) do
            window:Toggle()
        end
    end
end)

-- Set global reference
getgenv().CustomUILib = CustomUILib

-- Load completion message
print(string.format("[Custom UI Library] Loaded in %.3f seconds", tick() - LoadTime))

return CustomUILib
