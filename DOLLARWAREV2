
local DollarwareV2 = {}
local args = {...}
local settings = args[1] or {}

-- Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- Config
local ConfigName = settings.ConfigName or "DollarwareV2_Config"
local ConfigFolder = "DollarwareV2_Configs"
if not isfolder(ConfigFolder) then makefolder(ConfigFolder) end
local ConfigPath = ConfigFolder .. "/" .. ConfigName .. ".json"

-- Themes (expanded from original)
local Themes = {
    Cherry = {
        Bg = Color3.fromRGB(25, 25, 25),
        Accent = Color3.fromRGB(255, 0, 0),
        Text = Color3.fromRGB(255, 255, 255),
        Secondary = Color3.fromRGB(35, 35, 35)
    },
    Dark = {
        Bg = Color3.fromRGB(20, 20, 20),
        Accent = Color3.fromRGB(0, 162, 255),
        Text = Color3.fromRGB(255, 255, 255),
        Secondary = Color3.fromRGB(30, 30, 30)
    },
    Light = {
        Bg = Color3.fromRGB(240, 240, 240),
        Accent = Color3.fromRGB(0, 120, 215),
        Text = Color3.fromRGB(0, 0, 0),
        Secondary = Color3.fromRGB(255, 255, 255)
    }
}
local Theme = Themes[settings.Theme or "Cherry"] or Themes.Cherry
local Rounding = settings.Rounding ~= false  -- Default true
local AnimSpeed = settings.AnimSpeed or 0.3

-- Tween Helper (improved from original)
local function Tween(obj, props, duration, style)
    style = style or Enum.EasingStyle.Quad
    local tweenInfo = TweenInfo.new(duration or AnimSpeed, style, Enum.EasingDirection.Out)
    local tween = TweenService:Create(obj, tweenInfo, props)
    tween:Play()
    return tween
end

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DollarwareV2"
ScreenGui.ResetOnSpawn = false
ScreenGui.DisplayOrder = 999
ScreenGui.Parent = game.CoreGui

-- Notification System
local NotificationHolder = Instance.new("Frame")
NotificationHolder.Name = "Notifications"
NotificationHolder.Size = UDim2.new(0, 300, 1, 0)
NotificationHolder.Position = UDim2.new(1, -310, 0, 0)
NotificationHolder.BackgroundTransparency = 1
NotificationHolder.Parent = ScreenGui

local function Notify(options)
    options = options or {}
    local notif = Instance.new("Frame")
    notif.Size = UDim2.new(0, 280, 0, 60)
    notif.Position = UDim2.new(0, 0, 0, #NotificationHolder:GetChildren() * 70)
    notif.BackgroundColor3 = Theme.Secondary
    notif.BorderSizePixel = 0
    if Rounding then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = notif
    end
    notif.Parent = NotificationHolder

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -10, 0, 20)
    title.Position = UDim2.new(0, 5, 0, 5)
    title.BackgroundTransparency = 1
    title.Text = options.Title or "Notification"
    title.TextColor3 = Theme.Text
    title.TextScaled = true
    title.Font = Enum.Font.GothamBold
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = notif

    local message = Instance.new("TextLabel")
    message.Size = UDim2.new(1, -10, 0, 25)
    message.Position = UDim2.new(0, 5, 0, 25)
    message.BackgroundTransparency = 1
    message.Text = options.Message or ""
    message.TextColor3 = Theme.Text
    message.TextScaled = true
    message.Font = Enum.Font.Gotham
    message.TextXAlignment = Enum.TextXAlignment.Left
    message.TextWrapped = true
    message.Parent = notif

    Tween(notif, {Position = UDim2.new(0, 0, 0, (#NotificationHolder:GetChildren() - 1) * 70)}, 0.5)
    wait(3)
    Tween(notif, {Position = UDim2.new(1, 10, 0, notif.Position.Y.Offset)}, 0.5):Wait()
    notif:Destroy()
end

-- Window Class
local Window = {}
Window.__index = Window

function Window.new(options)
    local self = setmetatable({}, Window)
    options = options or {}
    self.Title = options.Text or "Dollarware V2"
    self.Size = options.Size or UDim2.new(0, 550, 0, 400)
    self.Position = options.Position or UDim2.new(1, -570, 0.5, -210)
    self.Resizable = options.Resize or true
    self.Minimized = false

    -- Main Frame
    self.Frame = Instance.new("Frame")
    self.Frame.Name = "Window"
    self.Frame.Size = self.Size
    self.Frame.Position = self.Position
    self.Frame.BackgroundColor3 = Theme.Bg
    self.Frame.BorderSizePixel = 0
    self.Frame.ClipsDescendants = true
    self.Frame.Active = true
    self.Frame.Draggable = true
    if Rounding then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 12)
        corner.Parent = self.Frame
    end
    self.Frame.Parent = ScreenGui

    -- Title Bar
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 40)
    TitleBar.BackgroundColor3 = Theme.Accent
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = self.Frame

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -80, 1, 0)
    TitleLabel.Position = UDim2.new(0, 10, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = self.Title
    TitleLabel.TextColor3 = Theme.Text
    TitleLabel.TextScaled = true
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.Parent = TitleBar

    -- Minimize Button
    local MinimizeBtn = Instance.new("TextButton")
    MinimizeBtn.Name = "Minimize"
    MinimizeBtn.Size = UDim2.new(0, 30, 0, 30)
    MinimizeBtn.Position = UDim2.new(1, -90, 0, 5)
    MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    MinimizeBtn.Text = "-"
    MinimizeBtn.TextColor3 = Theme.Bg
    MinimizeBtn.Font = Enum.Font.GothamBold
    MinimizeBtn.TextScaled = true
    MinimizeBtn.Parent = TitleBar
    if Rounding then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 4)
        corner.Parent = MinimizeBtn
    end
    MinimizeBtn.MouseButton1Click:Connect(function()
        self.Minimized = not self.Minimized
        Tween(self.Frame, {Size = self.Minimized and UDim2.new(self.Size.X.Scale, self.Size.X.Offset, 0, 40) or self.Size}, AnimSpeed)
        MinimizeBtn.Text = self.Minimized and "+" or "-"
    end)

    -- Close Button
    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Name = "Close"
    CloseBtn.Size = UDim2.new(0, 30, 0, 30)
    CloseBtn.Position = UDim2.new(1, -50, 0, 5)
    CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Theme.Text
    CloseBtn.Font = Enum.Font.GothamBold
    CloseBtn.TextScaled = true
    CloseBtn.Parent = TitleBar
    if Rounding then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 4)
        corner.Parent = CloseBtn
    end
    CloseBtn.MouseButton1Click:Connect(function()
        self.Frame:Destroy()
    end)

    -- Content Frame
    self.Content = Instance.new("Frame")
    self.Content.Name = "Content"
    self.Content.Size = UDim2.new(1, 0, 1, -40)
    self.Content.Position = UDim2.new(0, 0, 0, 40)
    self.Content.BackgroundTransparency = 1
    self.Content.Parent = self.Frame

    -- Resize Handle (if enabled)
    if self.Resizable then
        local ResizeHandle = Instance.new("Frame")
        ResizeHandle.Name = "ResizeHandle"
        ResizeHandle.Size = UDim2.new(0, 10, 0, 10)
        ResizeHandle.Position = UDim2.new(1, -10, 1, -10)
        ResizeHandle.BackgroundColor3 = Theme.Secondary
        ResizeHandle.Parent = self.Frame
        if Rounding then
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 4)
            corner.Parent = ResizeHandle
        end
        -- Basic resize logic (connect to UserInputService for drag-resize)
        local dragging = false
        local startPos, startSize
        ResizeHandle.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                startPos = self.Frame.Position
                startSize = self.Frame.Size
            end
        end)
        UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = input.Position - startPos
                self.Frame.Size = UDim2.new(startSize.X.Scale, startSize.X.Offset + delta.X, startSize.Y.Scale, startSize.Y.Offset + delta.Y)
            end
        end)
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
    end

    self.Menus = {}
    self.Config = {}

    -- Load Config
    pcall(function()
        local file = readfile(ConfigPath)
        self.Config = HttpService:JSONDecode(file)
    end)

    return self
end

function Window:AddMenu(options)
    local menu = {
        Title = options.Text or "Menu",
        Sections = {},
        Selected = nil
    }

    -- Menu Tab Button
    local TabBtn = Instance.new("TextButton")
    TabBtn.Name = "Tab_" .. menu.Title
    TabBtn.Size = UDim2.new(0, 120, 0, 30)
    TabBtn.Position = UDim2.new(0, #self.Menus * 130, 0, 50)
    TabBtn.BackgroundColor3 = Theme.Secondary
    TabBtn.Text = menu.Title
    TabBtn.TextColor3 = Theme.Text
    TabBtn.Font = Enum.Font.Gotham
    TabBtn.TextScaled = true
    TabBtn.Parent = self.Content
    if Rounding then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 6)
        corner.Parent = TabBtn
    end

    -- Menu Content
    menu.Content = Instance.new("ScrollingFrame")
    menu.Content.Name = "MenuContent"
    menu.Content.Size = UDim2.new(1, -130, 1, 0)
    menu.Content.Position = UDim2.new(0, 130, 0, 0)
    menu.Content.BackgroundTransparency = 1
    menu.Content.BorderSizePixel = 0
    menu.Content.ScrollBarThickness = 6
    menu.Content.ScrollBarImageColor3 = Theme.Accent
    menu.Content.Visible = false
    menu.Content.Parent = self.Content
    menu.Content.CanvasSize = UDim2.new(0, 0, 0, 0)

    TabBtn.MouseButton1Click:Connect(function()
        for _, m in pairs(self.Menus) do
            m.Content.Visible = false
        end
        menu.Content.Visible = true
        Tween(TabBtn, {BackgroundColor3 = Theme.Accent}, AnimSpeed)
    end)

    -- Select first menu
    if #self.Menus == 0 then
        TabBtn.MouseButton1Click:Fire()
    end

    table.insert(self.Menus, menu)
    return menu
end

function Window:SaveConfig()
    writefile(ConfigPath, HttpService:JSONEncode(self.Config))
    Notify({Title = "Config Saved", Message = "Settings saved to " .. ConfigName})
end

function Window:LoadConfig()
    -- Apply loaded config to elements (implement per-element binding)
    Notify({Title = "Config Loaded", Message = "Settings loaded from " .. ConfigName})
end

-- Section Class
local Section = {}
Section.__index = Section

function Menu:AddSection(options)
    local self = setmetatable({Elements = {}, YPos = 0}, Section)
    options = options or {}
    self.Title = options.Text or "Section"
    self.Side = options.Side or "left"  -- left/right for dual-column

    local SectionFrame = Instance.new("Frame")
    SectionFrame.Name = self.Title
    SectionFrame.Size = UDim2.new(1, -20, 0, 30)
    SectionFrame.Position = UDim2.new(0, 10, 0, self.YPos)
    SectionFrame.BackgroundTransparency = 1
    SectionFrame.Parent = menu.Content  -- menu is from AddMenu

    local SectionLabel = Instance.new("TextLabel")
    SectionLabel.Size = UDim2.new(1, 0, 1, 0)
    SectionLabel.BackgroundTransparency = 1
    SectionLabel.Text = self.Title
    SectionLabel.TextColor3 = Theme.Accent
    SectionLabel.TextScaled = true
    SectionLabel.Font = Enum.Font.GothamBold
    SectionLabel.Parent = SectionFrame

    self.Frame = Instance.new("Frame")
    self.Frame.Size = UDim2.new(1, 0, 0, 0)
    self.Frame.Position = UDim2.new(0, 0, 1, 5)
    self.Frame.BackgroundTransparency = 1
    self.Frame.Parent = SectionFrame

    self.YPos = self.YPos + 40
    menu.Content.CanvasSize = UDim2.new(0, 0, 0, self.YPos)

    return self
end

-- Elements (Toggle, Button, Label, Slider, Dropdown)
function Section:AddLabel(options)
    options = options or {}
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, #self.Elements * 25)
    label.BackgroundTransparency = 1
    label.Text = options.Text or "Label"
    label.TextColor3 = Theme.Text
    label.TextScaled = true
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = self.Frame
    table.insert(self.Elements, label)
    self.Frame.Size = self.Frame.Size + UDim2.new(0, 0, 0, 25)
    return label
end

local Toggle = {}
Toggle.__index = Toggle

function Section:AddToggle(options)
    options = options or {}
    local toggle = setmetatable({State = options.State or false, Callback = options.Callback}, Toggle)

    local toggleFrame = Instance.new("Frame")
    toggleFrame.Size = UDim2.new(1, 0, 0, 25)
    toggleFrame.Position = UDim2.new(0, 0, 0, #self.Elements * 30)
    toggleFrame.BackgroundTransparency = 1
    toggleFrame.Parent = self.Frame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -50, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = options.Text or "Toggle"
    label.TextColor3 = Theme.Text
    label.TextScaled = true
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = toggleFrame

    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Size = UDim2.new(0, 40, 0, 20)
    toggleBtn.Position = UDim2.new(1, -45, 0.5, -10)
    toggleBtn.BackgroundColor3 = toggle.State and Theme.Accent or Theme.Secondary
    toggleBtn.Text = ""
    toggleBtn.Font = Enum.Font.Gotham
    toggleBtn.TextScaled = true
    toggleBtn.Parent = toggleFrame
    if Rounding then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 10)
        corner.Parent = toggleBtn
    end

    local indicator = Instance.new("Frame")
    indicator.Size = UDim2.new(0, 16, 0, 16)
    indicator.Position = toggle.State and UDim2.new(1, -20, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
    indicator.BackgroundColor3 = Theme.Bg
    indicator.Parent = toggleBtn
    if Rounding then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = indicator
    end

    toggleBtn.MouseButton1Click:Connect(function()
        toggle.State = not toggle.State
        Tween(toggleBtn, {BackgroundColor3 = toggle.State and Theme.Accent or Theme.Secondary}, AnimSpeed)
        Tween(indicator, {Position = toggle.State and UDim2.new(1, -20, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)}, AnimSpeed)
        if toggle.Callback then toggle.Callback(toggle.State) end
        -- Save to config: self.Config[options.Text] = toggle.State (implement binding)
    end)

    table.insert(self.Elements, toggleFrame)
    self.Frame.Size = self.Frame.Size + UDim2.new(0, 0, 0, 30)
    return toggle
end

function Toggle:BindToEvent(event, callback)
    -- For future events like 'onToggle'
    if event == "onToggle" then
        self.Callback = callback
    end
end

-- Add similar for Button, Slider, Dropdown (abbreviated for brevity; expand as needed)
function Section:AddButton(options)
    options = options or {}
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 30)
    button.Position = UDim2.new(0, 0, 0, #self.Elements * 35)
    button.BackgroundColor3 = Theme.Accent
    button.Text = options.Text or "Button"
    button.TextColor3 = Theme.Text
    button.Font = Enum.Font.Gotham
    button.TextScaled = true
    button.Parent = self.Frame
    if Rounding then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 6)
        corner.Parent = button
    end
    button.MouseButton1Click:Connect(options.Callback or function() Notify({Title = "Button", Message = "Clicked!"}) end)
    table.insert(self.Elements, button)
    self.Frame.Size = self.Frame.Size + UDim2.new(0, 0, 0, 35)
    return button
end

function Section:AddSlider(options)
    -- Implement slider with drag (similar to toggle, but with TextBox for value)
    -- Placeholder: Add a frame with slider bar
    local slider = self:AddLabel({Text = (options.Text or "Slider") .. ": " .. (options.Default or 50)})
    -- Full impl: Use a Frame with draggable inner bar, update label on change
    return slider
end

function Section:AddDropdown(options)
    -- Implement dropdown with list visibility on click
    -- Placeholder
    local dropdown = self:AddLabel({Text = options.Text or "Dropdown"})
    return dropdown
end

-- Global Functions
function DollarwareV2:Notify(options) Notify(options) end
function DollarwareV2:Load() -- Global load end
function DollarwareV2:Save() -- Global save end

-- Export
local Library = {newWindow = Window.new, notify = Notify}
setmetatable(Library, {__call = function(_, opts) return Window.new(opts) end})

return Library

-- Example Usage (add this after the library code to test)
--[[
local ui = loadstring(game:HttpGet("YOUR_GITHUB_RAW_LINK_HERE"))()  -- Or paste above code

local window = ui({
    Text = "Dollarware V2 Demo",
    Size = UDim2.new(0, 600, 0, 450),
    Theme = "Dark",  -- Cherry, Dark, Light
    Rounding = true,
    ConfigName = "DemoConfig"
})

local menu1 = window:AddMenu({Text = "Main"})

local section1 = menu1:AddSection({Text = "Toggles & Buttons", Side = "left"})

section1:AddLabel({Text = "Welcome to V2!"})
local myToggle = section1:AddToggle({
    Text = "Enable Feature",
    State = false,
    Callback = function(state)
        print("Toggled:", state)
    end
})
myToggle:BindToEvent("onToggle", function(state) print("Bound event:", state) end)

section1:AddButton({
    Text = "Click Me",
    Callback = function()
        ui:Notify({Title = "Demo", Message = "Button works!"})
    end
})

local menu2 = window:AddMenu({Text = "Settings"})
local sec2 = menu2:AddSection({Text = "Config"})
sec2:AddButton({Text = "Save Config", Callback = function() window:SaveConfig() end})
sec2:AddButton({Text = "Load Config", Callback = function() window:LoadConfig() end})

-- Add sliders/dropdowns as needed
-- window:SaveConfig()  -- Auto-save on changes via bindings
--]]
